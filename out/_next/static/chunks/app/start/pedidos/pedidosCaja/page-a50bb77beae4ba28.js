(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8648],{66868:(e,t,l)=>{Promise.resolve().then(l.bind(l,77256))},77256:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>T});var a=l(95155),i=l(48173),o=l.n(i),n=l(81996),r=l.n(n),d=l(8889),s=l(12115),c=l(70689),u=l(65068);let h=(e,t,l,a)=>{(0,s.useEffect)(()=>{let i=i=>{let o=i.keyCode||i.which;if(o>=48&&o<=57||13===o){let i=String.fromCharCode(o),n=e.findIndex(e=>e.ARTICULO===l[0]);if(-1!==parseFloat(n)){let l=[...e],o=l[n][a];"0"===o||""===o?l[n][a]=i:l[n][a]="".concat(o).concat(i),console.log(o),t(l)}}},o=i=>{if(8===(i.keyCode||i.which)){let i=e.findIndex(e=>e.ARTICULO===l[0]);if(-1!==i&&e[i][a]){let l=[...e],o=l[i][a];l[i][a]=o.slice(0,-1),""===l[i][a]&&(l[i][a]="0"),t(l)}}};return document.addEventListener("keypress",i),document.addEventListener("keydown",o),()=>{document.removeEventListener("keypress",i),document.removeEventListener("keydown",o)}},[e,l,a])};var x=l(58896),f=l(75436),C=l(6403),p=l(62347),g=l(2295),m=l(9561),v=l(23613),b=l(54255),j=l(75293),w=l(48803),I=l(21831),O=l(71014),R=l(6748),S=l(12983);let y=(0,S.A)((0,a.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var E=l(79545);let k=(0,S.A)((0,a.jsx)("path",{d:"M16 9v10H8V9zm-1.5-6h-5l-1 1H5v2h14V4h-3.5zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2z"}),"DeleteOutlined");r().node,r().number.isRequired,r().number.isRequired;let P={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxHeight:"90vh",maxWidth:"80vw",overflowY:"auto",overflowX:"hidden",padding:"16px",bgcolor:"#ffffff",border:"2px solid #000",boxShadow:24},A=[{field:"DESCRIPCION",headerName:"REFERENCIA",width:500,headerClassName:"header-bold"},{field:"SUBLINEA",headerName:"SUBLINEA",width:300,headerClassName:"header-bold"},{field:"TOTAL_DISP",headerName:"DISP",width:130,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},type:"number",headerClassName:"header-bold"},{field:"PRECIO",headerName:"PRECIO",width:130,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},editable:!0,type:"number",headerClassName:"header-bold"},{field:"EXIST_REAL",headerName:"EXISTREAL",width:130,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},type:"number",headerClassName:"header-bold"}],N=async()=>(await fetch(d.c.url+"/productos/listar_solo_para_mg",{method:"GET",headers:{"Content-Type":"application/json"}})).json(),T=()=>{let{setCaja:e,cliente:t}=(0,c.A)(),[l,i]=(0,s.useState)(!1),[n,r]=(0,s.useState)("CPed"),[d,S]=(0,s.useState)([]),[T,L]=(0,s.useState)(),[D,U]=(0,s.useState)(!0),[M,_]=(0,s.useState)([]),[F,z]=(0,s.useState)([]),[B,V]=(0,s.useState)([]),[G,J]=(0,s.useState)([]),[q,H]=(0,s.useState)({}),[X,Z]=(0,s.useState)(0);h(M,_,B,n),(0,s.useEffect)(()=>{(async()=>{let e=await N();e?(L(e),J(e),U(!1)):console.log("Error")})()},[]),(0,s.useEffect)(()=>{setTimeout(()=>{let e=Number(M.reduce((e,t)=>{let l=t.PRECIO*(1-t.PORC_DCTO/100)*(1+t.PORC_IMPUESTO/100);return e+t.CPed*l},0)).toFixed(0);Z("".concat(parseFloat(e).toLocaleString()))},100)},[M,B]),(0,s.useEffect)(()=>{if(void 0!==F){let e={};F.forEach((t,l)=>{let a=T.find(e=>e.ARTICULO===t);if(a){if(a.CPed=1,"string"==typeof a.PRECIO){let e=parseInt(a.PRECIO);a.PRECIO=isNaN(e)?0:Math.round(100*e)/100}else"number"==typeof a.PRECIO&&(a.PRECIO=Math.round(a.PRECIO))}e[l]=a});let t={...JSON.parse(localStorage.getItem("pedidoGTemp"))||{},...e};localStorage.setItem("pedidoTempG",JSON.stringify(t)),void 0!==t&&K()}},[F]);let W=e=>{L(G.filter(t=>{let l=t.ARTICULO&&t.ARTICULO.toString().toLowerCase(),a=t.DESCRIPCION&&t.DESCRIPCION.toString().toLowerCase();return(null==l?void 0:l.includes(e.toLowerCase()))||(null==a?void 0:a.includes(e.toLowerCase()))?t:null}).filter(e=>null!==e))},K=()=>{let e=JSON.parse(localStorage.getItem("pedidoTempG"));if(e&&e[0]&&e[0].ARTICULO){let t=Object.values(e),l=M.some(e=>e.ARTICULO===t[0].ARTICULO),a=[...M];l||_([...a,...t])}},Y=e=>()=>{H({...q,[e]:{mode:w.V_.Edit}})},$=e=>()=>{H({...q,[e]:{mode:w.V_.View}})},Q=e=>()=>{_(M.filter(t=>t.ARTICULO!==e))},ee=e=>()=>{H({...q,[e]:{mode:w.V_.View,ignoreModifications:!0}}),M.find(t=>t.ARTICULO===e).isNew&&_(M.filter(t=>t.ARTICULO!==e))},et=[{field:"DESCRIPCION",headerName:"Referencia",width:500},{field:"CPed",headerName:"Cant",width:80,type:"number",editable:!0},{field:"PRECIO",headerName:"Precio",width:130},{field:"actions",type:"actions",headerName:"Actions",cellClassName:"actions",getActions:e=>{var t;let{id:l}=e;return(null===(t=q[l])||void 0===t?void 0:t.mode)===w.V_.Edit?[(0,a.jsx)(I.Z,{icon:(0,a.jsx)(R.A,{}),label:"Save",sx:{color:"primary.main"},onClick:$(l)}),(0,a.jsx)(I.Z,{icon:(0,a.jsx)(y,{}),label:"Cancel",className:"textPrimary",onClick:ee(l),color:"inherit"})]:[(0,a.jsx)(I.Z,{icon:(0,a.jsx)(E.A,{}),label:"Edit",className:"textPrimary",onClick:Y(l),color:"inherit"}),(0,a.jsx)(I.Z,{icon:(0,a.jsx)(k,{}),label:"Delete",className:"textPrimary",onClick:Q(l),color:"inherit"})]}}],el=e=>{let t=e.currentTarget.value,l=M.findIndex(e=>e.ARTICULO===B[0]);if(-1!==l){let e=[...M],a=e[l][n];"0"===a||""===a?e[l][n]=t:e[l][n]="".concat(a).concat(t),_(e)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(f.default,{children:[" ",(0,a.jsx)(u.A,{})," "]}),(0,a.jsx)(f.default,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:2,flexWrap:"wrap",mt:2,mr:4},children:(0,a.jsx)(C.Ay,{sx:{ml:1,flex:1,maxWidth:"300px",border:"2px solid black",borderRadius:"4px",p:1,mb:2},type:"text",value:d,onChange:e=>{S(e.target.value),W(e.target.value)},placeholder:"Escanea el c\xf3digo de barras aqu\xed",onKeyDown:e=>{"Enter"===e.key&&""!==d&&(z([d]),V([d]),S([]),console.log(d),console.log(F))},autoFocus:!0})}),(0,a.jsxs)(f.default,{sx:{display:"flex",flexDirection:"row",height:"100%",justifyContent:"space-between"},children:[(0,a.jsxs)(f.default,{sx:{width:"30%",display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsx)(f.default,{sx:{mb:1,height:600,width:"100%","& .MuiDataGrid-cell--editable":{bgcolor:e=>"dark"===e.palette.mode?"#376331":"#f5f5f5","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#27512":"#e1e1e1"}},"& .super-app-theme--header":{backgroundColor:"rgba(0, 0, 0, 0.541)",color:"#fff"}},children:(0,a.jsx)(O.z,{density:"compact",rows:M,columns:et,editMode:"row",getRowId:e=>e.ARTICULO,rowSelectionModel:B,rowModesModel:q,onRowModesModelChange:e=>{H(e)},onRowSelectionModelChange:e=>{V(e)},onRowEditStop:(e,t)=>{e.reason===j.q.rowFocusOut&&(t.defaultMuiPrevented=!0)},processRowUpdate:e=>{let t={...e,isNew:!1};return t.CPed=t.CPed||0,_(M.map(l=>l.ARTICULO===e.ARTICULO?t:l)),t},pageSizeOptions:[5,16],slotProps:{toolbar:{setProductosP:_,setRowModesModel:H}},initialState:{pagination:{paginationModel:{page:0,pageSize:16}}}})}),(0,a.jsxs)(f.default,{sx:{display:"flex",flexDirection:"column",justifyContent:"flex-end",mt:1},children:[(0,a.jsx)(p.A,{variant:"text","aria-label":"text button group",sx:{height:20},children:(0,a.jsxs)(g.default,{sx:{flexDirection:"row"},children:[(0,a.jsxs)(m.default,{variant:"outline",sx:{paddingRight:2,color:"black"},gutterBottom:!0,children:[" "," Total:$"," "]}),(0,a.jsxs)(m.default,{gutterBottom:!0,children:[" ",X," "]})]})}),(0,a.jsx)(f.default,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:(0,a.jsxs)(p.A,{variant:"outlined","aria-label":"text button group",children:[(0,a.jsx)(g.default,{sx:{display:"flex",flexDirection:"column"},children:(0,a.jsxs)(m.default,{sx:{display:"flex",color:"black"},gutterBottom:!0,children:[" ","Nota del Cliente"," "]})}),(0,a.jsx)(g.default,{sx:{display:"flex",flexDirection:"column"},children:(0,a.jsxs)(m.default,{sx:{display:"flex",color:"black"},gutterBottom:!0,children:[" ","Reembolso"," "]})}),(0,a.jsx)(g.default,{sx:{display:"flex",flexDirection:"column"},children:(0,a.jsxs)(m.default,{sx:{display:"flex",color:"black"},gutterBottom:!0,children:[" ","Informacion"," "]})})]})}),(0,a.jsxs)(f.default,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",height:"230px",overflow:"auto"},children:[(0,a.jsxs)(p.A,{orientation:"vertical","aria-label":"vertical outlined button group",variant:"text",sx:{margin:"2px",width:"100%",height:"100%"},children:[(0,a.jsxs)(g.default,{variant:"outlined",sx:{width:"100%",height:"30%"},onClick:()=>i(!0),children:["Cliente:",t.NOMBREALIAS]}),(0,a.jsx)(v.A,{open:l,onClose:()=>i(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,a.jsx)(f.default,{sx:P,children:(0,a.jsx)(x.default,{setOpen:i})})}),(0,a.jsx)(g.default,{component:o(),variant:"outlined",href:"0"!==X?"/start/caja/":"",onClick:"0"!==X?()=>{let t={total:X,...M};localStorage.setItem("pago",JSON.stringify(t)),e(t)}:null,sx:{width:"100%",height:"100%",backgroundColor:"0"!==X?"#00796b":"transparent",color:"0"!==X?"white":"black"},children:"Pago"})]}),(0,a.jsxs)(p.A,{orientation:"vertical","aria-label":"vertical outlined button group",variant:"text",sx:{margin:"2px",width:"30%",height:"100%"},children:[(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:1,onClick:el,children:[" ","1"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:4,onClick:el,children:[" ","4"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:7,onClick:el,children:[" ","7"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:0,onClick:el,children:[" ","+/-"," "]})]}),(0,a.jsxs)(p.A,{orientation:"vertical","aria-label":"vertical contained button group",variant:"text",sx:{margin:"2px",width:"30%",height:"100%"},children:[(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:2,onClick:el,children:[" ","2"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:5,onClick:el,children:[" ","5"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:8,onClick:el,children:[" ","8"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:0,onClick:el,children:[" ","0"," "]})]}),(0,a.jsxs)(p.A,{orientation:"vertical","aria-label":"vertical contained button group",variant:"text",sx:{margin:"2px",width:"30%",height:"100%"},children:[(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:3,onClick:el,children:[" ","3"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:6,onClick:el,children:[" ","6"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:9,onClick:el,children:[" ","9"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},value:0,onClick:el,children:[" ",","," "]})]}),(0,a.jsxs)(p.A,{orientation:"vertical","aria-label":"vertical contained button group",variant:"text",sx:{margin:"2px",width:"30%",height:"100%"},children:[(0,a.jsxs)(g.default,{variant:"outlined",sx:{backgroundColor:"CPed"===n?"#606060":"transparent",color:"CPed"===n?"white":"",height:"100%"},onClick:()=>r("CPed"),children:[" ","Ctdad"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{backgroundColor:"PORC_DCTO"===n?"#606060":"transparent",color:"PORC_DCTO"===n?"white":"",height:"100%"},onClick:()=>r("PORC_DCTO"),children:[" ","%Desc"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{backgroundColor:"PRECIO"===n?"#606060":"transparent",color:"PRECIO"===n?"white":"",height:"100%"},onClick:()=>r("PRECIO"),children:[" ","Precio"," "]}),(0,a.jsxs)(g.default,{variant:"outlined",sx:{height:"100%"},onClick:()=>{let e=M.findIndex(e=>e.ARTICULO===B[0]);if(-1!==e&&M[e][n]){let t=[...M],l=t[e][n];t[e][n]=l.slice(0,-1),""===t[e][n]&&(t[e][n]="0"),_(t)}},children:[" ","X"," "]})]})]})]})]}),(0,a.jsx)(f.default,{sx:{display:"flex",width:"70%",alignItems:"center",height:"100%",justifyContent:"space-between",flexDirection:"column"},children:(0,a.jsx)(f.default,{sx:{display:"flex",width:"100%",height:900,"& .super-app-theme--header":{backgroundColor:"#DCDCDC",color:"#000000"}},children:!0===D?(0,a.jsxs)(f.default,{sx:{width:"100%"},children:[" ",(0,a.jsx)(b.A,{})," "]}):(0,a.jsx)(O.z,{rows:T,columns:A,getRowId:e=>e.ARTICULO,pageSizeOptions:[10,15,20,30],onRowSelectionModelChange:e=>{z(e);let t=M.map(t=>e.includes(t.ARTICULO)?{...t,CPed:t.CPed?t.CPed+1:1}:t);_(t);let l={};e.forEach((e,a)=>{let i=t.find(t=>t.ARTICULO===e);i&&(l[a]=i)});let a={...JSON.parse(localStorage.getItem("pedidoGTemp"))||{},...l};localStorage.setItem("pedidoTemp",JSON.stringify(a)),void 0!==a&&K()},initialState:{pagination:{paginationModel:{page:0,pageSize:15}}},onSelectionModelChange:e=>z(e),rowSelectionModel:F})})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[339,8320,9754,1083,1260,6403,152,8173,2670,7493,1669,1014,7567,2520,8441,1517,7358],()=>t(66868)),_N_E=e.O()}]);